#################################### PATHS #####################################
tmux_dir="~/.tmux"
tmux_conf_dir="$tmux_dir/conf"
tmux_plugins_dir="$tmux_dir/plugins"
set-environment -g TMUX_PLUGIN_MANAGER_PATH "$tmux_plugins_dir"

#################################### COLORS ####################################
color_bg="#2e323b"
color_fg="default"
color_green="#98c379"
color_yellow="#e5c07b"
color_red="#e06c75"
color_blue="#61afef"
color_cyan="#56b6c2"
color_purple="#c678dd"
color_gray="#5c6370"
color_buffer="#939aa3"
color_selection="#3e4452"

################################### UI / UX ####################################
# General
set-option -g default-terminal "${TERM}"

# Status bar (minimal, top, roomy)
set -g status on
set -g status-position top
set -g status-style "bg=$color_fg"
set -g status-left-length 90
set -g status-right-length 90
set -g status-justify centre
set -g status-interval 5

# Messages, panes, and copy mode
set -g message-style bg=$color_blue,fg=$color_bg
setw -g window-status-separator "  "
set-window-option -g mode-style "bg=$color_purple,fg=$color_bg"

# Window titles 
setw -g automatic-rename on
setw -g allow-rename on
setw -g window-status-format "#[fg=white]#I:#W"
setw -g window-status-current-format "#[fg=$color_blue]#I:#W"

# Status content (left shows mode + pomodoro; right shows battery + clock)
set -g status-left "#{tmux_mode_indicator}#[fg=$color_gray]#{pomodoro_status}"
set -g status-right "#[fg=$color_gray]#{battery_icon_charge}#{battery_percentage} | %R"

################################ MODE INDICATOR ################################
set -g @mode_indicator_prefix_prompt "WAIT"
set -g @mode_indicator_copy_prompt   "COPY"
set -g @mode_indicator_sync_prompt   "SYNC"
set -g @mode_indicator_empty_prompt  "TMUX"

set -g @mode_indicator_empty_mode_style  "fg=$color_gray,bold"
set -g @mode_indicator_prefix_mode_style "fg=$color_cyan,bold"
set -g @mode_indicator_copy_mode_style   "fg=$color_yellow,bold"
set -g @mode_indicator_sync_mode_style   "fg=$color_red,bold"

################################ BATTERY WIDGET ################################
# Icons by tier
set -g @batt_icon_charge_tier8 "ÔâÄ"
set -g @batt_icon_charge_tier7 "ÔâÄ"
set -g @batt_icon_charge_tier6 "ÔâÅ"
set -g @batt_icon_charge_tier5 "ÔâÅ"
set -g @batt_icon_charge_tier4 "ÔâÇ"
set -g @batt_icon_charge_tier3 "ÔâÇ"
set -g @batt_icon_charge_tier2 "ÔâÉ"
set -g @batt_icon_charge_tier1 "ÔâÉ"

# Status suffixes
set -g @batt_icon_status_charged     " "
set -g @batt_icon_status_charging    " ÔÉß "
set -g @batt_icon_status_discharging " "
set -g @batt_icon_status_attached    " "
set -g @batt_icon_status_unknown     " "
set -g @batt_remain_short true

############################### POMODORO (PLUS) ################################
# Keys
set -g @pomodoro_toggle 'p'      # start/pause
set -g @pomodoro_cancel 'P'      # cancel
set -g @pomodoro_skip '_'        # skip

# Timings
set -g @pomodoro_mins 25
set -g @pomodoro_break_mins 5
set -g @pomodoro_intervals 4
set -g @pomodoro_long_break_mins 25
set -g @pomodoro_repeat 'off'
set -g @pomodoro_disable_breaks 'off'

# Display + notifications (minimal markers)
set -g @pomodoro_notifications 'on'
set -g @pomodoro_sound 'Pop'
set -g @pomodoro_granularity 'off'
set -g @pomodoro_menu_position "R"
set -g @pomodoro_on       " #[fg=$color_gray]ÓÄÅ "
set -g @pomodoro_complete " #[fg=$color_green]ÓÄÅ "

################################### PLUGINS ####################################
# Plugin manager
set -g @plugin 'tmux-plugins/tpm'

# Core utilities
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-open'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-battery'

# Workflow
set -g @plugin 'jaclu/tmux-menus'
set -g @plugin 'laktak/extrakto'
set -g @plugin 'olimorris/tmux-pomodoro-plus'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'MunifTanjim/tmux-mode-indicator'

################################ PLUGIN OPTS ###################################
# Resurrect / Continuum
set -g @resurrect-dir "$tmux_dir/resurrect"
set -g @resurrect-save 'S'                 # save session
set -g @resurrect-restore 'R'             # restore session
set -g @continuum-restore 'on'            # auto-restore last session
set -g @resurrect-strategy-nvim 'session' # use Session.vim if present

# Yank
set -g @yank_with_mouse on                # drag-select to copy

################################# KEY BINDINGS #################################
set -g @menus_trigger 'Space'

bind-key "√∂" run-shell "sesh connect \"$(
  sesh list --icons | fzf-tmux -p 80%,70% \
    --no-sort --ansi --border-label ' sesh ' --prompt '‚ö°  ' \
    --header '  ^a all ^t tmux ^g configs ^x zoxide ^d tmux kill ^f find' \
    --bind 'tab:down,btab:up' \
    --bind 'ctrl-a:change-prompt(‚ö°  )+reload(sesh list --icons)' \
    --bind 'ctrl-t:change-prompt(ü™ü  )+reload(sesh list -t --icons)' \
    --bind 'ctrl-g:change-prompt(‚öôÔ∏è  )+reload(sesh list -c --icons)' \
    --bind 'ctrl-x:change-prompt(üìÅ  )+reload(sesh list -z --icons)' \
    --bind 'ctrl-f:change-prompt(üîé  )+reload(fd -H -d 2 -t d -E .Trash . ~)' \
    --bind 'ctrl-d:execute(tmux kill-session -t {2..})+change-prompt(‚ö°  )+reload(sesh list --icons)' \
    --preview-window 'right:55%' \
    --preview 'sesh preview {}'
)\""

################################# FINALIZE #####################################
run "$tmux_plugins_dir/tpm/tpm"